<!doctype html>
<html>

<head>
    <title>unquote</title>
    <meta name="viewport" content="width=device-width, minimum-scale=0, initial-scale=1.0, user-scalable=yes">
    <script src="components/platform/platform.js"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script src="js/gmaps.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>
    <script src="js/jsonrpc-ws-client.js" type="text/javascript"></script>
    <link rel='stylesheet' type='text/css' href='style.css'>
    <script src="elements/request-page/request-page.js"></script>

    <link rel="import" href="components/font-roboto/roboto.html">
    <link rel="import" href="components/core-icons/core-icons.html">
    <link rel="import" href="components/core-toolbar/core-toolbar.html">
    <link rel="import" href="components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="components/paper-button/paper-button.html">
    <link rel="import" href="components/paper-tabs/paper-tabs.html">
    <link rel="import" href="components/core-drawer-panel/core-drawer-panel.html">
    <link rel="import" href="components/core-menu/core-submenu.html">
    <link rel="import" href="components/core-item/core-item.html">
    <link rel="import" href="components/core-icon-button/core-icon-button.html">
    <link rel="import" href="components/core-scaffold/core-scaffold.html">
    <link rel="import" href="components/core-header-panel/core-header-panel.html">
    <link rel="import" href="components/core-menu/core-menu.html">
    <link rel="import" href="components/core-item/core-item.html">
    <link rel="import" href="components/core-pages/core-pages.html">
    <link rel="import" href="components/core-icon/core-icon.html">
    <link rel="import" href="components/core-input/core-input.html">
    <link rel="import" href="components/paper-toast/paper-toast.html">
    <link rel="import" href="elements/request-form/request-form.html">
    <link rel="import" href="elements/registration-form/registration-from.html">
    <link rel="import" href="elements/request-page/request-page.html">

    <style>

    </style>
</head>

<body unresolved touch-action="auto">
    <core-scaffold responsiveWidth="1333px" id="core_scaffold">
        <core-header-panel mode="seamed" id="core_header_panel" navigation flex>
            <core-toolbar id="core_toolbar">
                <core-icon icon="search" id="core_icon"></core-icon>
                <core-input placeholder="Search" id="core_input"></core-input>
            </core-toolbar>
            <core-menu selected="Map" valueattr="label" selectedindex="0" id="core_menu" theme="core-light-theme">
                <core-item label="Map" icon="settings" size="24" id="main_item" horizontal center layout active></core-item>
                <core-item label="Request Form" icon="settings" size="24" id="request_form_item" horizontal center layout></core-item>
                <core-item label="Request Page" icon="settings" size="24" id="request_page_item" horizontal center layout></core-item>
                <core-item label="Registration From" icon="settings" size="24" id="registration_form_item" horizontal center layout></core-item>
            </core-menu>

        </core-header-panel>
        <div id="div" tool>
            <span>Сервис взаимопомощи</span>
            <span>
                <core-icon icon="account-circle"></core-icon>
            </span>
        </div>

        <core-pages class="content" id="page" selected="0">
            <div class="content"><div class="map" id="map"></div></div>
            <div><request-form></request-form></div>
            <div>
                <request-page
                        title="Разгрузить вещи моей жены"
                        address="ул. Маршала Жукова 233 кв. 142"
                        description="Очень много вещей. Эта жирная скотина собирала их 10 лет. Я хотел бы выбросить всё это говно, но оно ей очень сильно необходимо. Мы живём на 29-м этаже и лифт не работает. Собираемся переезжать. Мужики помогите я же сам коньчусь тут всё это говно выносить. Благаю"
                        manAmount="11">
                </request-page>
            </div>
            <div><registration-form></registration-form></div>
        </core-pages>

        <paper-toast id="toast" class="capsule" text="text" style="margin: auto"></paper-toast>
    </core-scaffold>
</body>


</html>
<script>
    //    var core_icon_button = document.getElementById('core_icon_button');
    //
    //    core_icon_button.addEventListener('core-select', function() {
    //        //alert("Selected: " + tabs.selected);
    //    });

    document.querySelector('request-page').helps = [{
        users: [{name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '3', surname: 'Vakhmenin', avatar: 'photo.jpg'}]
    },{
        users: [{name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'}, {name: '3', surname: 'Vakhmenin', avatar: 'photo.jpg'}]
    }];
//    document.querySelector('request-page').helpers = [{name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'},{name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'},{name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'},{name: 'Alex', surname: 'Vakhmenin', avatar: 'photo.jpg'},{name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'},{name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'},{name: '2', surname: 'Vakhmenin', avatar: 'photo.jpg'},{name: '3', surname: 'Vakhmenin', avatar: 'photo.jpg'}];

    document.querySelector("#main_item").onclick = function(e) {
        page = document.querySelector("core-pages#page")
        page.selected = 0;
    };

    document.querySelector("#request_form_item").onclick = function(e) {
        page = document.querySelector("core-pages#page")
        page.selected = 1;
    };

    document.querySelector("#request_page_item").onclick = function(e) {
        page = document.querySelector("core-pages#page")
        page.selected = 2;
    };

    document.querySelector("#registration_form_item").onclick = function(e) {
        page = document.querySelector("core-pages#page")
        page.selected = 3;
    };

    var map = new GMaps({
        div: '#map',
        lat: 46.28,
        lng: 30.44,
        width: screen.availWidth,
        height: screen.availHeight
    });



    GMaps.geolocate({
        success: function(position) {
            map.setCenter(position.coords.latitude, position.coords.longitude);
            map.addMarker({

                lat: position.coords.latitude,
                lng: position.coords.longitude,
                title: "Собор ёба!",
                animation: 'BOUNCE',
                infoWindow: {
                    content: "<div class='circular' style='background: url(img/photo.jpg) no-repeat;'></div>" +
                            "<h2>Собор</h2>" +
                            "<p>Описание описывает описывает описывает описывает описывает описывает описывает описывает " +
                            "описывает описывает описывает описывает описывает описывает описывает описывает описывает " +
                            "описывает описывает описывает описывает описывает описывает " +
                            "описывает описывает описывает описывает описывает описывает</p>" +
                            "<paper-button raisedButton class='colored' label='Подробнее'></paper-button>"
                }

            });
        },
        error: function(error) {
            alert('Geolocation failed: '+error.message);
        },
        not_supported: function() {
            alert("Your browser does not support geolocation");
        }
    });

    $(document).ready(function(){
        var socket = io('http://localhost:8489');

        socket.on('connect', function(){
            var rpc = new rpcClient(socket);
            // rpc.call('rpc.add', 0, 20, function(resp){ console.log("result: " +  resp.result) } );
            rpc.call('rpc.getAllMarkers',function(resp){
               // alert(resp.result);
                map.addMarkers(resp.result);
            });

//            socket.send( JSON.stringify({id:1,method:"rpc,getAllMarkers",params:""}) )
        });




        socket.on('message', function(r){ console.log("response: " + r) });

        socket.connect();
        socket.close();
    });

</script>
